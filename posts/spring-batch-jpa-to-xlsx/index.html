<!DOCTYPE html>
<html lang="en-us">
<head>
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-brands-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-regular-400.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/font-awesome/webfonts/fa-solid-900.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <link rel="preload" href="/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Spring Batch - JPA to XLSX with Apache POI | Waldemar Panas&#39; blog</title>
  <link rel = 'canonical' href = 'https://blog.wpanas.eu/posts/spring-batch-jpa-to-xlsx/'>
  
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Spring Batch - JPA to XLSX with Apache POI" />
<meta property="og:description" content="Getting started with Spring Batch and processing XLSX files" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.wpanas.eu/posts/spring-batch-jpa-to-xlsx/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-02-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-02-24T00:00:00+00:00" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Spring Batch - JPA to XLSX with Apache POI"/>
<meta name="twitter:description" content="Getting started with Spring Batch and processing XLSX files"/>

  
  
    
  
  
  
  
  
  <link rel="stylesheet" href="https://blog.wpanas.eu/css/styles.5839778cedecb9ab9c753d5ec1666dfba39c614b06ece1a5283bd11d5f3809a68971ba4690222d7e924a1b89b47428ed10c156dfcc1d259cecc8ebc11bc5c053.css" integrity="sha512-WDl3jO3suaucdT1ewWZt&#43;6OcYUsG7OGlKDvRHV84CaaJcbpGkCItfpJKG4m0dCjtEMFW38wdJZzsyOvBG8XAUw=="> 

  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://blog.wpanas.eu/images/favicon.ico" />

  
  
  
  
  
    
<script async src="https://www.googletagmanager.com/gtag/js?id=G-HNT2RP39GX"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-HNT2RP39GX', { 'anonymize_ip': false });
}
</script>

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

  <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">All posts</a></li>
         
        <li><a href="https://github.com/wpanas/">About</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li>
          <a class="icon" href=" https://blog.wpanas.eu/posts/maven-build-your-own-projects-repository/" aria-label="Previous">
            <i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i>
          </a>
        </li>
        
        
        <li>
          <a class="icon" href="https://blog.wpanas.eu/posts/android-learning-resources/" aria-label="Next">
            <i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i>
          </a>
        </li>
        
        <li>
          <a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
            <i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i>
          </a>
        </li>
        <li>
          <a class="icon" href="#" aria-label="Share">
            <i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i>
          </a>
        </li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f" aria-label="Facebook">
      <i class="fab fa-facebook " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f&text=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI" aria-label="Twitter">
      <i class="fab fa-twitter " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f&title=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI" aria-label="Linkedin">
      <i class="fab fa-linkedin " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f&is_video=false&description=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI" aria-label="Pinterest">
      <i class="fab fa-pinterest " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI&body=Check out this article: https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f" aria-label="Email">
      <i class="fas fa-envelope " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f&title=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI" aria-label="Pocket">
      <i class="fab fa-get-pocket " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f&title=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI" aria-label="reddit">
      <i class="fab fa-reddit " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f&name=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI&description=Getting%20started%20with%20Spring%20Batch%20and%20processing%20XLSX%20files" aria-label="Tumblr">
      <i class="fab fa-tumblr " aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f&t=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI" aria-label="Hacker News">
      <i class="fab fa-hacker-news " aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>
    
    <div id="toc">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-apache-poi">What is Apache POI?</a></li>
    <li><a href="#spring-batch-sxssf-example">Spring Batch SXSSF Example</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
    
  </span>
</div>


  <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
    <header>
      <h1 class="posttitle" itemprop="name headline">
        Spring Batch - JPA to XLSX with Apache POI
      </h1>
      <div class="meta">
        
        <div class="postdate">
          
          <time datetime="2018-02-24 00:00:00 &#43;0000 UTC" itemprop="datePublished">2018-02-24</time>
          
        </div>
        
        
        
        
      </div>
    </header>

  
    
    <div class="content" itemprop="articleBody">
      <h2 id="what-is-apache-poi">What is Apache POI?</h2>
<p><a href="https://poi.apache.org/">Apache POI</a> is a Java library that allows reading and writing Microsoft Documents.
It supports Excel, Word, PowerPoint and even Visio.</p>
<p>In this article I will focus on Excel and its current file format XLSX.
Apache POI provides low-memory footprint API, SXSSF, for writing to XLSX files. You can specify how many rows are processed in the memory by setting a sliding window.
If number of rows exceeds the size of the window, they are flushed to temporary files. At the end all data is transferred to specified by you destination file.</p>
<p>Spring Framework has its own library for processing large amounts of data. It is called Spring Batch.
Spring Batch has support for CSV files, but natively doesn&rsquo;t support XLSX files. You can achieve storing data to XLSX with support of Apache POI SXSSF API.</p>
<h2 id="spring-batch-sxssf-example">Spring Batch SXSSF Example</h2>
<p>Let&rsquo;s say you have a bookstore. You also have an application that allows you to store information about books available for sale.
You want to make an order for new books. Your deliverer wants you to send him an XLSX file with list of books to deliver.</p>
<p>Below is JPA representation of your bookstore&rsquo;s application logic. You have a <code>Book</code> model and a repository that keep information about books in a database.</p>
<p><code>@Data</code> annotation is part of <a href="https://projectlombok.org/features/Data">Project Lombok</a>. It generates <code>toString</code>, <code>equals</code>,
<code>hashCode</code>, getters and setters methods for all properties.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Data</span>
<span style="color:#a6e22e">@Entity</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Book</span> <span style="color:#f92672">{</span>
    <span style="color:#a6e22e">@Id</span>
    <span style="color:#a6e22e">@GeneratedValue</span><span style="color:#f92672">(</span>strategy <span style="color:#f92672">=</span> GenerationType<span style="color:#f92672">.</span><span style="color:#a6e22e">AUTO</span><span style="color:#f92672">)</span>
    <span style="color:#66d9ef">private</span> Long id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String title<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String author<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String isbn<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Repository</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">BookRepository</span> <span style="color:#66d9ef">extends</span> PagingAndSortingRepository<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">,</span> Long<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>To process data from a JPA repository you need to create a <code>RepositoryItemReader</code> and a configuration that enables batch processing and JPA repositories.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Configuration</span>
<span style="color:#a6e22e">@EnableBatchProcessing</span>
<span style="color:#a6e22e">@EnableJpaRepositories</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BatchConfiguration</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">int</span> CHUNK <span style="color:#f92672">=</span> 100<span style="color:#f92672">;</span>

    <span style="color:#a6e22e">@Bean</span>
    <span style="color:#66d9ef">public</span> ItemReader<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">bookReader</span><span style="color:#f92672">(</span>BookRepository repository<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        RepositoryItemReader<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> reader <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RepositoryItemReader<span style="color:#f92672">&lt;&gt;();</span>
        reader<span style="color:#f92672">.</span><span style="color:#a6e22e">setRepository</span><span style="color:#f92672">(</span>repository<span style="color:#f92672">);</span>
        reader<span style="color:#f92672">.</span><span style="color:#a6e22e">setMethodName</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;findAll&#34;</span><span style="color:#f92672">);</span>
        reader<span style="color:#f92672">.</span><span style="color:#a6e22e">setPageSize</span><span style="color:#f92672">(</span>CHUNK<span style="color:#f92672">);</span>
        reader<span style="color:#f92672">.</span><span style="color:#a6e22e">setSort</span><span style="color:#f92672">(</span>singletonMap<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">,</span> Sort<span style="color:#f92672">.</span><span style="color:#a6e22e">Direction</span><span style="color:#f92672">.</span><span style="color:#a6e22e">ASC</span><span style="color:#f92672">));</span>
        <span style="color:#66d9ef">return</span> reader<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

</code></pre></div><p>Fetched books are going to be written in a spreadsheet.
All spreadsheets are kept in a <code>Workbook</code>, so before that you have to create one.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Bean</span>
<span style="color:#66d9ef">public</span> SXSSFWorkbook <span style="color:#a6e22e">workbook</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> SXSSFWorkbook<span style="color:#f92672">(</span>CHUNK<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><code>SXSSFWorkbook</code> number of stored in memory rows is explicitly set to <code>CHUNK</code>.
With <code>Workbook</code> you can create a spreadsheet called <code>Books</code>. It will be passed
to <code>BookWriter</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Bean</span>
<span style="color:#66d9ef">public</span> ItemWriter<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">bookWriter</span><span style="color:#f92672">(</span>SXSSFWorkbook workbook<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    SXSSFSheet sheet <span style="color:#f92672">=</span> workbook<span style="color:#f92672">.</span><span style="color:#a6e22e">createSheet</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Books&#34;</span><span style="color:#f92672">);</span>
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">new</span> BookWriter<span style="color:#f92672">(</span>sheet<span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><code>BookWriter</code> is a class that adds a new row to a spreadsheet for each book
in the repository. Book properties are saved as cells in columns.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BookWriter</span> <span style="color:#66d9ef">implements</span> ItemWriter<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> Sheet sheet<span style="color:#f92672">;</span>

    BookWriter<span style="color:#f92672">(</span>Sheet sheet<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">sheet</span> <span style="color:#f92672">=</span> sheet<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>List<span style="color:#f92672">&lt;?</span> <span style="color:#66d9ef">extends</span> Book<span style="color:#f92672">&gt;</span> list<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> list<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">();</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
            writeRow<span style="color:#f92672">(</span>i<span style="color:#f92672">,</span> list<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>i<span style="color:#f92672">));</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">writeRow</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> currentRowNumber<span style="color:#f92672">,</span> Book book<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> columns <span style="color:#f92672">=</span> prepareColumns<span style="color:#f92672">(</span>book<span style="color:#f92672">);</span>
        Row row <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">sheet</span><span style="color:#f92672">.</span><span style="color:#a6e22e">createRow</span><span style="color:#f92672">(</span>currentRowNumber<span style="color:#f92672">);</span>
        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> 0<span style="color:#f92672">;</span> i <span style="color:#f92672">&lt;</span> columns<span style="color:#f92672">.</span><span style="color:#a6e22e">size</span><span style="color:#f92672">();</span> i<span style="color:#f92672">++)</span> <span style="color:#f92672">{</span>
            writeCell<span style="color:#f92672">(</span>row<span style="color:#f92672">,</span> i<span style="color:#f92672">,</span> columns<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span>i<span style="color:#f92672">));</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">prepareColumns</span><span style="color:#f92672">(</span>Book book<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> asList<span style="color:#f92672">(</span>
                book<span style="color:#f92672">.</span><span style="color:#a6e22e">getId</span><span style="color:#f92672">().</span><span style="color:#a6e22e">toString</span><span style="color:#f92672">(),</span>
                book<span style="color:#f92672">.</span><span style="color:#a6e22e">getAuthor</span><span style="color:#f92672">(),</span>
                book<span style="color:#f92672">.</span><span style="color:#a6e22e">getTitle</span><span style="color:#f92672">(),</span>
                book<span style="color:#f92672">.</span><span style="color:#a6e22e">getIsbn</span><span style="color:#f92672">()</span>
        <span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">writeCell</span><span style="color:#f92672">(</span>Row row<span style="color:#f92672">,</span> <span style="color:#66d9ef">int</span> currentColumnNumber<span style="color:#f92672">,</span> String value<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        Cell cell <span style="color:#f92672">=</span> row<span style="color:#f92672">.</span><span style="color:#a6e22e">createCell</span><span style="color:#f92672">(</span>currentColumnNumber<span style="color:#f92672">);</span>
        cell<span style="color:#f92672">.</span><span style="color:#a6e22e">setCellValue</span><span style="color:#f92672">(</span>value<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>To complete transfer of books from a JPA repository to a XLSX file, you need to create a <code>Job</code>. Every <code>Job</code> has at least one <code>Step</code> to make.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Bean</span>
<span style="color:#66d9ef">public</span> Step <span style="color:#a6e22e">step</span><span style="color:#f92672">(</span>ItemReader<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> reader<span style="color:#f92672">,</span> ItemWriter<span style="color:#f92672">&lt;</span>Book<span style="color:#f92672">&gt;</span> writer<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> stepBuilderFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;export&#34;</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">.&lt;</span>Book<span style="color:#f92672">,</span> Book<span style="color:#f92672">&gt;</span>chunk<span style="color:#f92672">(</span>CHUNK<span style="color:#f92672">)</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">reader</span><span style="color:#f92672">(</span>reader<span style="color:#f92672">)</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">writer</span><span style="color:#f92672">(</span>writer<span style="color:#f92672">)</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>

<span style="color:#a6e22e">@Bean</span>
<span style="color:#66d9ef">public</span> Job <span style="color:#a6e22e">job</span><span style="color:#f92672">(</span>Step step<span style="color:#f92672">,</span> JobExecutionListener listener<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">return</span> jobBuilderFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">get</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;exportBooksToXlsx&#34;</span><span style="color:#f92672">)</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">start</span><span style="color:#f92672">(</span>step<span style="color:#f92672">)</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">listener</span><span style="color:#f92672">(</span>listener<span style="color:#f92672">)</span>
            <span style="color:#f92672">.</span><span style="color:#a6e22e">build</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>When a <code>Job</code> status changes, a <code>JobExecutionListener</code> is called. At the completion of the <code>Job</code>, you can save books from <code>Workbook</code> to selected XLSX file using <code>FileOutputStream</code> and dispose created <code>Workbook</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Slf4j</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">JobListener</span> <span style="color:#66d9ef">implements</span> JobExecutionListener <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> SXSSFWorkbook workbook<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">final</span> FileOutputStream fileOutputStream<span style="color:#f92672">;</span>

    JobListener<span style="color:#f92672">(</span>SXSSFWorkbook workbook<span style="color:#f92672">,</span> FileOutputStream fileOutputStream<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">workbook</span> <span style="color:#f92672">=</span> workbook<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">fileOutputStream</span> <span style="color:#f92672">=</span> fileOutputStream<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">afterJob</span><span style="color:#f92672">(</span>JobExecution jobExecution<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        BatchStatus batchStatus <span style="color:#f92672">=</span> jobExecution<span style="color:#f92672">.</span><span style="color:#a6e22e">getStatus</span><span style="color:#f92672">().</span><span style="color:#a6e22e">getBatchStatus</span><span style="color:#f92672">();</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">(</span>batchStatus <span style="color:#f92672">==</span> COMPLETED<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            <span style="color:#66d9ef">try</span> <span style="color:#f92672">{</span>
                workbook<span style="color:#f92672">.</span><span style="color:#a6e22e">write</span><span style="color:#f92672">(</span>fileOutputStream<span style="color:#f92672">);</span>
                fileOutputStream<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
                workbook<span style="color:#f92672">.</span><span style="color:#a6e22e">dispose</span><span style="color:#f92672">();</span>
            <span style="color:#f92672">}</span> <span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
                log<span style="color:#f92672">.</span><span style="color:#a6e22e">error</span><span style="color:#f92672">(</span>e<span style="color:#f92672">.</span><span style="color:#a6e22e">getMessage</span><span style="color:#f92672">(),</span> e<span style="color:#f92672">);</span>
            <span style="color:#f92672">}</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">beforeJob</span><span style="color:#f92672">(</span>JobExecution jobExecution<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>

    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="summary">Summary</h2>
<p>Spring Batch is very elastic, and it can help you process big data chunks with any available library.
This example shows how to do it with Apache POI, but you can easily changed it for your own purposes.
Remember to maximize your performance with setting chunks. When the RAM memory will be exceeded, the speed of data processing will drop
significantly.</p>
<p>Project created for this article is available on <a href="https://github.com/wpanas/code-snippets/tree/master/jpa-to-xlsx">GitHub</a>.</p>

    </div>
  </article>

  
  




  
    <div class="blog-post-comments">
        <div id="disqus_thread">
          <script type="text/javascript">
          
          (function() {
              
              
              
              
          
              var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
              var disqus_shortname = 'waldemar-panas-blog';
              dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
              (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="https://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </div>

  


  <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/posts">All posts</a></li>
         
          <li><a href="https://github.com/wpanas/">About</a></li>
        
      </ul>
    </div>

    
    <div id="toc-footer" style="display: none">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-apache-poi">What is Apache POI?</a></li>
    <li><a href="#spring-batch-sxssf-example">Spring Batch SXSSF Example</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
    

    <div id="share-footer" style="display: none">
      
      <ul>
  
  
    
  
  
  <li>
    <a class="icon" href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f" aria-label="Facebook">
      <i class="fab fa-facebook fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://twitter.com/share?url=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f&text=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI" aria-label="Twitter">
      <i class="fab fa-twitter fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f&title=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI" aria-label="Linkedin">
      <i class="fab fa-linkedin fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f&is_video=false&description=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI" aria-label="Pinterest">
      <i class="fab fa-pinterest fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="mailto:?subject=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI&body=Check out this article: https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f" aria-label="Email">
      <i class="fas fa-envelope fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://getpocket.com/save?url=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f&title=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI" aria-label="Pocket">
      <i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://reddit.com/submit?url=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f&title=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI" aria-label="reddit">
      <i class="fab fa-reddit fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="http://www.tumblr.com/share/link?url=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f&name=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI&description=Getting%20started%20with%20Spring%20Batch%20and%20processing%20XLSX%20files" aria-label="Tumblr">
      <i class="fab fa-tumblr fa-lg" aria-hidden="true"></i>
    </a>
  </li>
  <li>
    <a class="icon" href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fblog.wpanas.eu%2fposts%2fspring-batch-jpa-to-xlsx%2f&t=Spring%20Batch%20-%20JPA%20to%20XLSX%20with%20Apache%20POI" aria-label="Hacker News">
      <i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i>
    </a>
  </li>
</ul>

    </div>

    <div id="actions-footer">
      
        <a id="menu-toggle" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;" aria-label="Menu">
          <i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="toc-toggle" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;" aria-label="TOC">
          <i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share-toggle" class="icon" href="#" onclick="$('#share-footer').toggle();return false;" aria-label="Share">
          <i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" aria-label="Top of Page">
          <i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>


  <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2022  Waldemar Panas 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">Home</a></li>
         
        <li><a href="/posts">All posts</a></li>
         
        <li><a href="https://github.com/wpanas/">About</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>



</html>
